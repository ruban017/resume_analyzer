import face_recognition
import cv2
import numpy as np
import csv
import os
from datetime import datetime

video_capture = cv2.VideoCapture(0)

Ibrahim_image = face_recognition.load_image_file("data:image/jpeg;base64,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")
Ibrahim_encoding =  face_recognition.face_encodings(Ibrahim_image)[0]

Rishy_image = face_recognition.load_image_file("photos/gal.jpg")
Rishy_encoding = face_recognition.face_encodings(Rishy_image)[0]

Ruban_image=  face_recognition.load_image_file("photos/Ruban.png")
Ruban_encoding= face_recognition.face_encodings(Ruban_image)[0]

Srihari_image =face_recognition.load_image_file("photos/ryan.jpg")
Srihari_encoding= face_recognition.face_encodings(Srihari_image)[0]

known_face_encoding = [
Ibrahim_encoding,
Rishy_encoding,
Ruban_encoding,
Srihari_encoding
]

known_faces_names = [
"Virat",
"Gal gadot",
"Ruban",
"ryan"
]

students =  known_faces_names.copy()

face_locations=[]
face_encodings=[]
face_names=[]
s=True
present=[]

now=datetime.now()
current_date=now.strftime("%Y-%m-%d")

f=open(current_date+".csv","w+",newline='')
f=open("AbsentList"+".csv","w+",newline='')
lnwriter=csv.writer(f)

while True:
    _,frame=video_capture.read()
    small_frame = cv2.resize(frame,(0,0),fx=0.25,fy=0.25)
    rgb_small_frame=small_frame[:,:,::-1]
    if s:
        face_locations = face_recognition.face_locations(rgb_small_frame)
        face_encodings = face_recognition.face_encodings(rgb_small_frame,face_locations)
        face_names = []
        for face_encoding in face_encodings:
            matches = face_recognition.compare_faces(known_face_encoding,face_encoding)
            name=""
            face_distance=face_recognition.face_distance(known_face_encoding,face_encoding)
            best_match_index =  np.argmin(face_distance)
            if matches[best_match_index]:
                name=known_faces_names[best_match_index]

            face_names.append(name)
            if name in known_faces_names:
                if name in students:
                    students.remove(name)
                    print(students)
                    current_time = now.strftime("%H-%M-%S")
                    lnwriter.writerow([name,current_time])


    cv2.imshow("attendance system",frame)
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

lnwriter.writerow(["AbsentList"])
for i in students:
    print(i)
    lnwriter.writerow([i,""])

video_capture.release()
cv2.destroyAllWindows()
f.close()